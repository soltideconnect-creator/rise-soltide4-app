#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ”’ Pre-commit: Verifying lockfile integrity..."

# Check if package.json or pnpm-lock.yaml are being committed
if git diff --cached --name-only | grep -q "package.json\|pnpm-lock.yaml"; then
  echo "ğŸ“¦ Package files detected in commit. Running integrity checks..."
  
  # Verify lockfile matches package.json
  if ! pnpm install --frozen-lockfile > /dev/null 2>&1; then
    echo "âŒ ERROR: pnpm-lock.yaml is out of sync with package.json!"
    echo "Run: pnpm install"
    echo "Then stage the updated pnpm-lock.yaml"
    exit 1
  fi
  
  echo "âœ… Lockfile integrity verified"
fi

# Run linting
echo "ğŸ” Running linter..."
npm run lint

echo "âœ… Pre-commit checks passed!"
