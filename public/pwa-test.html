<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rise PWA Test Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #5E5CE6;
      margin-bottom: 10px;
      font-size: 32px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #5E5CE6;
    }
    
    .test-section h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 20px;
    }
    
    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
    
    .status.pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .test-item {
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .test-item:last-child {
      border-bottom: none;
    }
    
    .test-label {
      font-weight: 600;
      color: #555;
      margin-bottom: 5px;
    }
    
    .test-value {
      color: #333;
      font-family: 'Courier New', monospace;
      background: white;
      padding: 8px 12px;
      border-radius: 5px;
      margin-top: 5px;
      font-size: 14px;
    }
    
    button {
      background: #5E5CE6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
      transition: all 0.3s;
    }
    
    button:hover {
      background: #4a4bc7;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(94, 92, 230, 0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }
    
    .console-log div {
      padding: 3px 0;
      border-bottom: 1px solid #333;
    }
    
    .console-log div:last-child {
      border-bottom: none;
    }
    
    .success-icon {
      color: #28a745;
      font-size: 20px;
      margin-right: 5px;
    }
    
    .error-icon {
      color: #dc3545;
      font-size: 20px;
      margin-right: 5px;
    }
    
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
    }
    
    .info-box strong {
      color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Rise PWA Test Page</h1>
    <p class="subtitle">Verify that all PWA features are working correctly</p>
    
    <!-- Test 1: Service Worker -->
    <div class="test-section">
      <h2>
        Test 1: Service Worker Registration
        <span class="status pending" id="sw-status">Testing...</span>
      </h2>
      <div class="test-item">
        <div class="test-label">Service Worker Support:</div>
        <div class="test-value" id="sw-support">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Registration Status:</div>
        <div class="test-value" id="sw-registration">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Service Worker State:</div>
        <div class="test-value" id="sw-state">Checking...</div>
      </div>
      <button onclick="testServiceWorker()">Re-test Service Worker</button>
    </div>
    
    <!-- Test 2: Manifest -->
    <div class="test-section">
      <h2>
        Test 2: Web App Manifest
        <span class="status pending" id="manifest-status">Testing...</span>
      </h2>
      <div class="test-item">
        <div class="test-label">Manifest Loaded:</div>
        <div class="test-value" id="manifest-loaded">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">App Name:</div>
        <div class="test-value" id="manifest-name">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Display Mode:</div>
        <div class="test-value" id="manifest-display">Checking...</div>
      </div>
      <button onclick="testManifest()">Re-test Manifest</button>
    </div>
    
    <!-- Test 3: Icons -->
    <div class="test-section">
      <h2>
        Test 3: App Icons
        <span class="status pending" id="icon-status">Testing...</span>
      </h2>
      <div class="test-item">
        <div class="test-label">Favicon:</div>
        <div class="test-value" id="icon-favicon">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Manifest Icons:</div>
        <div class="test-value" id="icon-manifest">Checking...</div>
      </div>
      <button onclick="testIcons()">Re-test Icons</button>
    </div>
    
    <!-- Test 4: Install Prompt -->
    <div class="test-section">
      <h2>
        Test 4: Install Prompt
        <span class="status pending" id="install-status">Testing...</span>
      </h2>
      <div class="test-item">
        <div class="test-label">Install Prompt Available:</div>
        <div class="test-value" id="install-available">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Display Mode:</div>
        <div class="test-value" id="install-display">Checking...</div>
      </div>
      <button onclick="triggerInstall()" id="install-button">Trigger Install Prompt</button>
    </div>
    
    <!-- Test 5: Offline Mode -->
    <div class="test-section">
      <h2>
        Test 5: Offline Support
        <span class="status pending" id="offline-status">Testing...</span>
      </h2>
      <div class="test-item">
        <div class="test-label">Cache Storage:</div>
        <div class="test-value" id="offline-cache">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Cached Files:</div>
        <div class="test-value" id="offline-files">Checking...</div>
      </div>
      <div class="test-item">
        <div class="test-label">Online Status:</div>
        <div class="test-value" id="offline-online">Checking...</div>
      </div>
      <button onclick="testOffline()">Re-test Offline Support</button>
    </div>
    
    <!-- Console Log -->
    <div class="test-section">
      <h2>Console Log</h2>
      <div class="console-log" id="console-log">
        <div>Initializing tests...</div>
      </div>
      <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <!-- Info Box -->
    <div class="info-box">
      <strong>üìù Testing Instructions:</strong><br>
      1. All tests run automatically on page load<br>
      2. Check each test section for results<br>
      3. Green status = Pass, Red status = Fail<br>
      4. Use "Re-test" buttons to run tests again<br>
      5. Check console log for detailed information<br>
      6. For offline test: Use DevTools ‚Üí Network ‚Üí Offline checkbox
    </div>
  </div>
  
  <script>
    let deferredPrompt;
    const consoleLog = document.getElementById('console-log');
    
    function log(message, type = 'info') {
      const div = document.createElement('div');
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
      div.textContent = `[${timestamp}] ${icon} ${message}`;
      consoleLog.appendChild(div);
      consoleLog.scrollTop = consoleLog.scrollHeight;
      console.log(message);
    }
    
    function clearConsole() {
      consoleLog.innerHTML = '<div>Console cleared.</div>';
    }
    
    function updateStatus(id, status) {
      const element = document.getElementById(id);
      element.className = `status ${status}`;
      element.textContent = status === 'success' ? '‚úÖ Pass' : status === 'error' ? '‚ùå Fail' : '‚è≥ Testing...';
    }
    
    // Test 1: Service Worker
    async function testServiceWorker() {
      log('Testing Service Worker...');
      updateStatus('sw-status', 'pending');
      
      try {
        if ('serviceWorker' in navigator) {
          document.getElementById('sw-support').textContent = '‚úÖ Supported';
          log('Service Worker API is supported', 'success');
          
          const registration = await navigator.serviceWorker.getRegistration();
          if (registration) {
            document.getElementById('sw-registration').textContent = '‚úÖ Registered at: ' + registration.scope;
            document.getElementById('sw-state').textContent = '‚úÖ ' + (registration.active ? 'Active' : 'Installing');
            log('Service Worker is registered and active', 'success');
            updateStatus('sw-status', 'success');
          } else {
            document.getElementById('sw-registration').textContent = '‚ùå Not registered';
            document.getElementById('sw-state').textContent = '‚ùå Not active';
            log('Service Worker is not registered', 'error');
            updateStatus('sw-status', 'error');
          }
        } else {
          document.getElementById('sw-support').textContent = '‚ùå Not supported';
          document.getElementById('sw-registration').textContent = '‚ùå N/A';
          document.getElementById('sw-state').textContent = '‚ùå N/A';
          log('Service Worker API is not supported', 'error');
          updateStatus('sw-status', 'error');
        }
      } catch (error) {
        log('Error testing Service Worker: ' + error.message, 'error');
        updateStatus('sw-status', 'error');
      }
    }
    
    // Test 2: Manifest
    async function testManifest() {
      log('Testing Web App Manifest...');
      updateStatus('manifest-status', 'pending');
      
      try {
        const response = await fetch('/manifest.json');
        if (response.ok) {
          const manifest = await response.json();
          document.getElementById('manifest-loaded').textContent = '‚úÖ Loaded successfully';
          document.getElementById('manifest-name').textContent = manifest.name || 'Not specified';
          document.getElementById('manifest-display').textContent = manifest.display || 'Not specified';
          log('Manifest loaded: ' + manifest.name, 'success');
          updateStatus('manifest-status', 'success');
        } else {
          document.getElementById('manifest-loaded').textContent = '‚ùå Failed to load';
          log('Failed to load manifest', 'error');
          updateStatus('manifest-status', 'error');
        }
      } catch (error) {
        document.getElementById('manifest-loaded').textContent = '‚ùå Error: ' + error.message;
        log('Error testing manifest: ' + error.message, 'error');
        updateStatus('manifest-status', 'error');
      }
    }
    
    // Test 3: Icons
    async function testIcons() {
      log('Testing App Icons...');
      updateStatus('icon-status', 'pending');
      
      try {
        // Test favicon
        const faviconResponse = await fetch('/favicon.png');
        if (faviconResponse.ok) {
          document.getElementById('icon-favicon').textContent = '‚úÖ Favicon exists';
          log('Favicon loaded successfully', 'success');
        } else {
          document.getElementById('icon-favicon').textContent = '‚ùå Favicon not found';
          log('Favicon not found', 'error');
        }
        
        // Test manifest icons
        const manifestResponse = await fetch('/manifest.json');
        if (manifestResponse.ok) {
          const manifest = await manifestResponse.json();
          const iconCount = manifest.icons ? manifest.icons.length : 0;
          document.getElementById('icon-manifest').textContent = `‚úÖ ${iconCount} icons defined`;
          log(`Manifest contains ${iconCount} icons`, 'success');
          updateStatus('icon-status', 'success');
        } else {
          document.getElementById('icon-manifest').textContent = '‚ùå Manifest not found';
          log('Manifest not found', 'error');
          updateStatus('icon-status', 'error');
        }
      } catch (error) {
        log('Error testing icons: ' + error.message, 'error');
        updateStatus('icon-status', 'error');
      }
    }
    
    // Test 4: Install Prompt
    function testInstallPrompt() {
      log('Testing Install Prompt...');
      updateStatus('install-status', 'pending');
      
      const displayMode = window.matchMedia('(display-mode: standalone)').matches ? 'standalone' : 'browser';
      document.getElementById('install-display').textContent = displayMode;
      
      if (displayMode === 'standalone') {
        document.getElementById('install-available').textContent = '‚úÖ App is installed';
        log('App is running in standalone mode', 'success');
        updateStatus('install-status', 'success');
        document.getElementById('install-button').disabled = true;
        document.getElementById('install-button').textContent = 'Already Installed';
      } else if (deferredPrompt) {
        document.getElementById('install-available').textContent = '‚úÖ Install prompt available';
        log('Install prompt is available', 'success');
        updateStatus('install-status', 'success');
      } else {
        document.getElementById('install-available').textContent = '‚è≥ Waiting for prompt (visit app 2-3 times)';
        log('Install prompt not yet available', 'info');
        updateStatus('install-status', 'pending');
      }
    }
    
    function triggerInstall() {
      if (deferredPrompt) {
        log('Triggering install prompt...');
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            log('User accepted the install prompt', 'success');
          } else {
            log('User dismissed the install prompt');
          }
          deferredPrompt = null;
        });
      } else {
        log('Install prompt not available. Try visiting the app multiple times.', 'error');
        alert('Install prompt not available yet. Please:\n1. Visit the app 2-3 times\n2. Wait a few minutes between visits\n3. Or use browser menu to install manually');
      }
    }
    
    // Test 5: Offline Support
    async function testOffline() {
      log('Testing Offline Support...');
      updateStatus('offline-status', 'pending');
      
      try {
        // Check cache storage
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          document.getElementById('offline-cache').textContent = `‚úÖ ${cacheNames.length} caches found`;
          log(`Found ${cacheNames.length} caches: ${cacheNames.join(', ')}`, 'success');
          
          // Count cached files
          let totalFiles = 0;
          for (const cacheName of cacheNames) {
            const cache = await caches.open(cacheName);
            const keys = await cache.keys();
            totalFiles += keys.length;
          }
          document.getElementById('offline-files').textContent = `‚úÖ ${totalFiles} files cached`;
          log(`Total cached files: ${totalFiles}`, 'success');
          updateStatus('offline-status', 'success');
        } else {
          document.getElementById('offline-cache').textContent = '‚ùå Cache API not supported';
          log('Cache API not supported', 'error');
          updateStatus('offline-status', 'error');
        }
        
        // Check online status
        const onlineStatus = navigator.onLine ? '‚úÖ Online' : '‚ö†Ô∏è Offline';
        document.getElementById('offline-online').textContent = onlineStatus;
        log(`Network status: ${navigator.onLine ? 'Online' : 'Offline'}`);
      } catch (error) {
        log('Error testing offline support: ' + error.message, 'error');
        updateStatus('offline-status', 'error');
      }
    }
    
    // Listen for install prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      log('Install prompt is ready', 'success');
      testInstallPrompt();
    });
    
    // Listen for app installed
    window.addEventListener('appinstalled', () => {
      log('App installed successfully!', 'success');
      deferredPrompt = null;
      testInstallPrompt();
    });
    
    // Listen for online/offline events
    window.addEventListener('online', () => {
      log('Network status: Online', 'success');
      testOffline();
    });
    
    window.addEventListener('offline', () => {
      log('Network status: Offline', 'info');
      testOffline();
    });
    
    // Run all tests on page load
    window.addEventListener('load', async () => {
      log('Starting PWA tests...');
      await testServiceWorker();
      await testManifest();
      await testIcons();
      testInstallPrompt();
      await testOffline();
      log('All tests completed!', 'success');
    });
  </script>
</body>
</html>
